# 架构设计注意点【数据库】

- 高可用
- 读写扩展
- 移植性
- 适合当前环境的方案

## 主从设计满足

- 读写分离，主从内容相同，根据sql语义路由，
- 目的是
  - 高可用
  - 读写扩展

1. 一主多从，扩展读
2. 多主多从，扩展了写和读
   1. 多主的结构会提高复杂度，运维等，不建议
   2. 真正的主从架构，考虑高可用，读扩展

## 分库分表

- 数据分片，目的读写扩展，存储扩容。库和表内容不同，根据分片配置路由。

## 读写分离数据一致性问题

- 多主库一致性，主从一致性
- 数据量不是很大，单纯读写分离，主从结构；
- 数据量达到500万，数据量预估千万级别，可以分表存储：主从＋分表；
- 数据量继续扩大，分库分表＋读写分离

## sharding-JDBC分库分表

目前仅支持mysql

### 基本流程

- sql解析
- 查询优化
- sql路由
- sql改写

### 基本概念

分库，分表，垂直分库分表，水平分库分表，笛卡尔积，

绑定表：分片规则一致，避免笛卡尔积

广播表：全局表，数据量少的配置表之类的，所有库都相同

分库策略，分表策略，自定义规则



基本配置



## sharding-JDBC读写分离功能

### 基本概念

主库，从库，主从同步，负载均衡

- ### 核心功能

  - 提供一主多从的读写分离。仅支持单主库，可以支持独立使用，也可以配合分库分表使用。
  - 独立使用读写分离，支持sql穿透，不需要sql改写流程
  - 
